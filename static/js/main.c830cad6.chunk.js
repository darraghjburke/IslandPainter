(this["webpackJsonpisland-painter"]=this["webpackJsonpisland-painter"]||[]).push([[0],{221:function(e,t,n){},244:function(e,t,n){},252:function(e,t,n){"use strict";n.r(t);var a,r,i,c,o,s,l,b,u,j,p,d,O,h,y,f,m,g,v,w,x,k,T,S,z,C,R,A,M,E,B,F,I,N,P,D,H,L,_,W,J,V,q,G,K,U,X,Z,Q,Y,$,ee,te,ne=n(72),ae=n.n(ne),re=n(235),ie=n.n(re),ce=(n(244),n.p,n(221),n(220)),oe=n.n(ce),se=n(236),le=n(106),be=n(130),ue=n(237),je=n(95),pe=n(238),de=n(239),Oe=n(28),he=["antialias","engineOptions","adaptToDeviceRatio","sceneOptions","onRender","onSceneReady"],ye=function(e){var t=Object(ne.useRef)(null),n=e.antialias,a=e.engineOptions,r=e.adaptToDeviceRatio,i=e.sceneOptions,c=e.onRender,o=(e.onSceneReady,Object(de.a)(e,he));return Object(ne.useEffect)((function(){if(t.current){var o=new je.Engine(t.current,n,a,r),s=new je.Scene(o,i);s.isReady()?e.onSceneReady(s):s.onReadyObservable.addOnce((function(t){return e.onSceneReady(t)})),o.runRenderLoop((function(){"function"===typeof c&&c(s),s.render()}));var l=function(){s.getEngine().resize()};return window&&window.addEventListener("resize",l),function(){s.getEngine().dispose(),window&&window.removeEventListener("resize",l)}}}),[t]),Object(Oe.jsx)("canvas",Object(pe.a)({ref:t},o))},fe=n(68),me=n(63),ge=n(157),ve=n(156),we=n(69),xe=(n(247),n(50)),ke=(a=Object(xe.type)("number"),r=Object(xe.type)("number"),i=Object(xe.type)("number"),c=function(e){Object(ge.a)(n,e);var t=Object(ve.a)(n);function n(){var e;Object(be.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(fe.a)(e,"x",o,Object(me.a)(e)),Object(fe.a)(e,"y",s,Object(me.a)(e)),Object(fe.a)(e,"z",l,Object(me.a)(e)),e}return n}(xe.Schema),o=Object(we.a)(c.prototype,"x",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),s=Object(we.a)(c.prototype,"y",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),l=Object(we.a)(c.prototype,"z",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),b=Object(xe.type)("number"),u=Object(xe.type)("number"),j=Object(xe.type)("number"),p=function(e){Object(ge.a)(n,e);var t=Object(ve.a)(n);function n(){var e;Object(be.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(fe.a)(e,"r",d,Object(me.a)(e)),Object(fe.a)(e,"g",O,Object(me.a)(e)),Object(fe.a)(e,"b",h,Object(me.a)(e)),e}return n}(xe.Schema),d=Object(we.a)(p.prototype,"r",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),O=Object(we.a)(p.prototype,"g",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),h=Object(we.a)(p.prototype,"b",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),p),Te=(y=Object(xe.type)("string"),f=Object(xe.type)(ke),m=Object(xe.type)("string"),g=function(e){Object(ge.a)(n,e);var t=Object(ve.a)(n);function n(){var e;Object(be.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(fe.a)(e,"id",v,Object(me.a)(e)),Object(fe.a)(e,"color",w,Object(me.a)(e)),Object(fe.a)(e,"name",x,Object(me.a)(e)),e}return n}(xe.Schema),v=Object(we.a)(g.prototype,"id",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=Object(we.a)(g.prototype,"color",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x=Object(we.a)(g.prototype,"name",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g),Se=(k=Object(xe.type)("number"),T=Object(xe.type)("number"),S=function(e){Object(ge.a)(n,e);var t=Object(ve.a)(n);function n(){var e;Object(be.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(fe.a)(e,"type",z,Object(me.a)(e)),Object(fe.a)(e,"rotation",C,Object(me.a)(e)),e}return n}(xe.Schema),z=Object(we.a)(S.prototype,"type",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C=Object(we.a)(S.prototype,"rotation",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),S),ze=(R=Object(xe.type)("number"),A=Object(xe.type)("number"),M=Object(xe.type)(Se),E=function(e){Object(ge.a)(n,e);var t=Object(ve.a)(n);function n(){var e;Object(be.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(fe.a)(e,"terrainType",B,Object(me.a)(e)),Object(fe.a)(e,"height",F,Object(me.a)(e)),Object(fe.a)(e,"building",I,Object(me.a)(e)),e}return n}(xe.Schema),B=Object(we.a)(E.prototype,"terrainType",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),F=Object(we.a)(E.prototype,"height",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),I=Object(we.a)(E.prototype,"building",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E),Ce=(N=Object(xe.type)("string"),P=Object(xe.type)(ke),D=Object(xe.type)("string"),H=function(e){Object(ge.a)(n,e);var t=Object(ve.a)(n);function n(){var e;Object(be.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(fe.a)(e,"name",L,Object(me.a)(e)),Object(fe.a)(e,"color",_,Object(me.a)(e)),Object(fe.a)(e,"message",W,Object(me.a)(e)),e}return n}(xe.Schema),L=Object(we.a)(H.prototype,"name",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_=Object(we.a)(H.prototype,"color",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W=Object(we.a)(H.prototype,"message",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),H),Re=(J=Object(xe.type)([Te]),V=Object(xe.type)("number"),q=Object(xe.type)("number"),G=Object(xe.type)([ze]),K=Object(xe.type)("string"),U=Object(xe.type)([Ce]),X=function(e){Object(ge.a)(n,e);var t=Object(ve.a)(n);function n(){var e;Object(be.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(fe.a)(e,"players",Z,Object(me.a)(e)),Object(fe.a)(e,"width",Q,Object(me.a)(e)),Object(fe.a)(e,"height",Y,Object(me.a)(e)),Object(fe.a)(e,"tiles",$,Object(me.a)(e)),Object(fe.a)(e,"name",ee,Object(me.a)(e)),Object(fe.a)(e,"messages",te,Object(me.a)(e)),e}return n}(xe.Schema),Z=Object(we.a)(X.prototype,"players",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new xe.ArraySchema}}),Q=Object(we.a)(X.prototype,"width",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),Y=Object(we.a)(X.prototype,"height",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),$=Object(we.a)(X.prototype,"tiles",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new xe.ArraySchema}}),ee=Object(we.a)(X.prototype,"name",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),te=Object(we.a)(X.prototype,"messages",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new xe.ArraySchema}}),X),Ae=(n(219),n(248),[{name:"Grass",color:"#3F9C74",asset:"hex_forest"},{name:"Water",color:"#3EB2BB",asset:"hex_water"},{name:"Sand",color:"#B69169",asset:"hex_sand"},{name:"Dirt",color:"#A76F52",asset:"hex_rock"}]),Me=[{name:"Forest",terrainTypes:[0],asset:"forest1",probability:.2},{name:"Forest with Rock",terrainTypes:[0],asset:"forest2",probability:.2},{name:"Rocks",terrainTypes:[0,2,3],asset:"rocks_small",probability:.1},{name:"Mountain",terrainTypes:[0,2,3],asset:"mountain",probability:.02},{name:"House",terrainTypes:[0,2],asset:"house",probability:.02},{name:"Farm",terrainTypes:[0],asset:"farm_plot",probability:.02},{name:"Mine",terrainTypes:[0,2,3],asset:"mine",probability:.01},{name:"Market",terrainTypes:[0,2,3],asset:"market",probability:.01},{name:"Windmill",terrainTypes:[0,2,3],asset:"mill",probability:.005},{name:"Lumbermill",terrainTypes:[0],asset:"lumbermill",probability:.01},{name:"Barracks",terrainTypes:[0,2,3],asset:"barracks",probability:.01},{name:"Archery Range",terrainTypes:[0,2,3],asset:"archeryrange",probability:.01},{name:"Watchtower",terrainTypes:[0,2,3],asset:"watchtower",probability:.01},{name:"Castle",terrainTypes:[0,2,3],asset:"castle",probability:5e-4},{name:"Bridge",terrainTypes:[1],asset:"bridge",probability:0}];function Ee(e){var t=Object(ne.useState)(0),n=Object(le.a)(t,2),a=n[0],r=n[1],i=Object(ne.useState)(0),c=Object(le.a)(i,2),o=c[0],s=c[1];Object(ne.useEffect)((function(){s(e.tile?e.tile.height:0),e.tile&&e.tile.building&&r(e.tile.building.rotation)}),[e.tile]);return Object(Oe.jsx)("div",{id:"tile-panel",className:e.tile?"":"hide",children:e.tile?Object(Oe.jsxs)(Oe.Fragment,{children:[Object(Oe.jsx)("div",{id:"terrain-type",children:Ae.map((function(t,n){return Object(Oe.jsx)("button",{onClick:function(){return e.setTerrainType(n)},className:e.tile.terrainType==n?"terrain selected":"terrain",style:{backgroundColor:t.color}})}))}),Object(Oe.jsx)("div",{className:"hr"}),Object(Oe.jsxs)("div",{id:"height",children:[Object(Oe.jsx)("div",{children:Object(Oe.jsx)("label",{htmlFor:"height",children:"Height"})}),Object(Oe.jsx)("input",{type:"range",step:"0.05",min:"0",max:"2",value:o,onChange:function(t){return function(t){s(t),e.setHeight(t)}(parseFloat(t.target.value))},id:"height"})]}),Object(Oe.jsx)("div",{className:"hr"}),e.tile.building?Object(Oe.jsxs)("div",{id:"building",children:[Object(Oe.jsx)("h3",{children:Me[e.tile.building.type].name}),Object(Oe.jsx)("div",{children:Object(Oe.jsx)("label",{htmlFor:"rotation",children:"Rotation"})}),Object(Oe.jsx)("input",{type:"range",min:"0",max:2*Math.PI,step:.1,value:a,onChange:function(t){return function(t){r(t),e.setRotation(t)}(parseFloat(t.target.value))},id:"rotation"}),Object(Oe.jsx)("button",{onClick:e.demolishBuilding,children:"Demolish Building"})]}):Object(Oe.jsxs)("div",{id:"no-building",children:[Object(Oe.jsx)("h3",{children:"Build"}),Me.map((function(t,n){return t.terrainTypes.includes(e.tile.terrainType)?Object(Oe.jsx)("button",{onClick:function(){return e.buildBuilding(n)},children:t.name},t.name):Object(Oe.jsx)(Oe.Fragment,{})}))]})]}):Object(Oe.jsx)(Oe.Fragment,{})})}var Be=function(e){var t=Object(ne.useState)(""),n=Object(le.a)(t,2),a=n[0],r=n[1],i=Object(ne.useRef)(null);return Object(ne.useEffect)((function(){i.current.scrollTop=i.current.scrollHeight}),[e.messages.length]),Object(Oe.jsxs)("div",{id:"left-panel",children:[Object(Oe.jsxs)("div",{id:"online-players",children:[Object(Oe.jsxs)("h3",{id:"player-count",children:["Online Players: ",e.players.length]}),e.players.map((function(e){return Object(Oe.jsx)("div",{className:"player-name",style:{color:"rgb(".concat(255*e.color.r,",").concat(255*e.color.g,",").concat(255*e.color.b,")")},children:e.name},e.id)}))]}),Object(Oe.jsx)("div",{className:"hr"}),Object(Oe.jsxs)("div",{id:"chat",children:[Object(Oe.jsxs)("div",{id:"messages",ref:i,children:[Object(Oe.jsx)("h3",{children:"Chat"}),e.messages.map((function(e){return Object(Oe.jsxs)("div",{className:"message",children:[Object(Oe.jsx)("span",{className:"player-name",style:{color:"rgb(".concat(255*e.color.r,",").concat(255*e.color.g,",").concat(255*e.color.b,")")},children:e.name}),Object(Oe.jsx)("span",{children:e.message})]})}))]}),Object(Oe.jsxs)("form",{id:"chatbox",onSubmit:function(t){t.preventDefault(),a.length>0&&(e.sendMessage(a),r(""))},children:[Object(Oe.jsx)("input",{autoComplete:"off",type:"text",value:a,onChange:function(e){return r(e.target.value)}}),Object(Oe.jsx)("button",{children:"Send"})]})]})]})};function Fe(){var e=Object(ne.useState)(!1),t=Object(le.a)(e,2),n=t[0],a=t[1];return Object(Oe.jsxs)(Oe.Fragment,{children:[n?Object(Oe.jsxs)("div",{id:"help-box",children:[Object(Oe.jsx)("h1",{children:"Island Painter"}),Object(Oe.jsxs)("p",{children:["Powered by ",Object(Oe.jsx)("a",{href:"https://babylonjs.com/",children:"Babylon.js"})]}),Object(Oe.jsxs)("p",{children:["Created by ",Object(Oe.jsx)("a",{href:"https://twitter.com/DarraghBurke13",children:"Darragh Burke"})]}),Object(Oe.jsxs)("p",{children:["Networking using ",Object(Oe.jsx)("a",{href:"https://www.colyseus.io/",children:"Colyseus"})]}),Object(Oe.jsxs)("p",{children:["Assets by ",Object(Oe.jsx)("a",{href:"https://kaylousberg.itch.io/kaykit-medieval-builder-pack",children:"Kay Lousberg"})," - check out their work!"]}),Object(Oe.jsxs)("p",{children:["Hex coordinate conversions by ",Object(Oe.jsx)("a",{href:"https://www.redblobgames.com/grids/hexagons",children:"RedBlobGames"})]}),Object(Oe.jsxs)("p",{children:["Hand drawn CSS from ",Object(Oe.jsx)("a",{href:"https://codemyui.com/hand-drawn-border-buttons-css/",children:"CodeMyUI"})]}),Object(Oe.jsx)("button",{onClick:function(){return a(!1)},children:"X"})]}):Object(Oe.jsx)(Oe.Fragment,{}),Object(Oe.jsx)("button",{onClick:function(){return a(!n)},id:"help-button",children:"?"})]})}var Ie=function e(t,n,a){var r=this;Object(be.a)(this,e),this.parentMesh=void 0,a.addMeshTask("task","","".concat("/IslandPainter","/assets/").concat(t,"/"),"".concat(n,".glb")).onSuccess=function(e){r.parentMesh=e.loadedMeshes[0],r.parentMesh.position.z=1e6}},Ne=function(){var e=Object(ne.useState)(-1),t=Object(le.a)(e,2),n=t[0],a=t[1],r=Object(ne.useState)(new Re),i=Object(le.a)(r,2),c=i[0],o=i[1],s=ae.a.useState({}),l=Object(le.a)(s,2),b=(l[0],l[1]),u=ae.a.useCallback((function(){return b({})}),[]),j=Object(ne.useState)(null),p=Object(le.a)(j,2),d=p[0],O=p[1],h=[],y=[];function f(){return(f=Object(se.a)(oe.a.mark((function e(t){var n;return oe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new je.AssetsManager(t),Ae.forEach((function(e){h.push(new Ie("tiles",e.asset,n))})),Me.forEach((function(e){y.push(new Ie("buildings",e.asset,n))})),e.next=5,n.loadAsync();case 5:g(t);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){return[1.1*(Math.sqrt(3)*e+Math.sqrt(3)/2*t),1.1*3/2*t]}function g(e){new ue.Client("wss://mamawn.us-west-1.colyseus.dev").joinOrCreate("my_room").then((function(t){O(t),console.log(t.sessionId,"joined",t.name),t.onStateChange((function(e){o(e),u()}));var n=t.state,r=m(12.5,12.5),i=Object(le.a)(r,2),c=i[0],s=i[1];e.cameras[0].target.set(c,2,s),e.cameras[0].radius=40,n.tiles.onAdd=function(t,a){var r=function(e,t){var n=[e%t,Math.floor(e/t)];return m(n[0],n[1])}(a,n.width),i=Object(le.a)(r,2),c=i[0],o=i[1],s=new je.TransformNode("".concat(a),e);s.position.set(c,t.height,o),s.metadata={key:a};var l=h[t.terrainType].parentMesh.clone("tile",s);l.position.set(0,0,0),l.setEnabled(!0),l.isPickable=!0;var b=null,u=null;t.listen("building",(function(n,a){if(a){var r=je.Animation.CreateAndStartAnimation("build",b,"position.y",60,10,1,0);r.loopAnimation=!1,r.onAnimationEndObservable.add((function(e){e.target.dispose()}))}n&&((b=new je.TransformNode("building",e)).parent=s,(u=y[n.type].parentMesh.clone("building",b)).position.set(0,0,0),u.setEnabled(!0),je.Animation.CreateAndStartAnimation("build",b,"position.y",60,10,0,1).loopAnimation=!1,t.building.listen("rotation",(function(e,n){b.rotation.y=t.building.rotation})))})),t.listen("terrainType",(function(e,n){n&&l.dispose(),e&&((l=h[t.terrainType].parentMesh.clone("tile",s)).position.set(0,0,0),l.setEnabled(!0),l.isPickable=!0)})),t.listen("height",(function(e,n){s.position.y=t.height}))},e.onPointerObservable.add((function(e){if(e.type==je.PointerEventTypes.POINTERDOWN)if(e.pickInfo&&e.pickInfo.pickedMesh){for(var t=e.pickInfo.pickedMesh;!t.metadata||!t.metadata.key;)t=t.parent;if(e.pickInfo&&e.pickInfo.pickedMesh){for(var n=e.pickInfo.pickedMesh;!n.metadata||!n.metadata.key;)if(!(n=n.parent))return;a(n.metadata.key)}}else a(-1)}))})).catch((function(e){console.log("JOIN ERROR",e)}))}return Object(Oe.jsxs)("div",{children:[Object(Oe.jsx)(ye,{antialias:!0,onSceneReady:function(e){!function(e){f.apply(this,arguments)}(e);var t=new je.ArcRotateCamera("my first camera",0,Math.PI/3,10,new je.Vector3(0,0,0),e);t.setTarget(je.Vector3.Zero());var n=e.getEngine().getRenderingCanvas();t.attachControl(n,!0),new je.HemisphericLight("light",new je.Vector3(0,1,0),e).intensity=.7},onRender:function(e){},id:"my-canvas"}),Object(Oe.jsx)(Ee,{tile:c.tiles[n],demolishBuilding:function(){return d.send("demolish",{key:n})},buildBuilding:function(e){return d.send("build",{key:n,type:e})},setTerrainType:function(e){return d.send("changeTerrainType",{key:n,type:e})},setHeight:function(e){return d.send("setHeight",{key:n,height:e})},setRotation:function(e){return d.send("setRotation",{key:n,rotation:e})}}),Object(Oe.jsx)(Be,{players:c.players,sendMessage:function(e){return d.send("message",{message:e})},messages:c.messages}),Object(Oe.jsx)("h1",{id:"world-name",children:c.name}),Object(Oe.jsx)(Fe,{})]})};var Pe=function(){return Object(Oe.jsx)("div",{className:"App",children:Object(Oe.jsx)(Ne,{})})},De=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,254)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),i(e),c(e)}))};ie.a.render(Object(Oe.jsx)(ae.a.StrictMode,{children:Object(Oe.jsx)(Pe,{})}),document.getElementById("root")),De()}},[[252,1,2]]]);
//# sourceMappingURL=main.c830cad6.chunk.js.map
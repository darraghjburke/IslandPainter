(this["webpackJsonpisland-painter"]=this["webpackJsonpisland-painter"]||[]).push([[0],{221:function(e,t,n){},244:function(e,t,n){},252:function(e,t,n){"use strict";n.r(t);var a,r,i,c,o,s,l,b,u,j,p,d,h,O,f,y,m,g,v,w,x,k,T,S,C,R,A,z,M,E,B,F,N,I,P,H,D,L,_,W,G,J,V,q,K,U,X,Z,Q=n(70),Y=n.n(Q),$=n(235),ee=n.n($),te=(n(244),n.p,n(221),n(220)),ne=n.n(te),ae=n(236),re=n(106),ie=n(140),ce=n(237),oe=n(93),se=n(238),le=n(239),be=n(28),ue=["antialias","engineOptions","adaptToDeviceRatio","sceneOptions","onRender","onSceneReady"],je=function(e){var t=Object(Q.useRef)(null),n=e.antialias,a=e.engineOptions,r=e.adaptToDeviceRatio,i=e.sceneOptions,c=e.onRender,o=(e.onSceneReady,Object(le.a)(e,ue));return Object(Q.useEffect)((function(){if(t.current){var o=new oe.Engine(t.current,n,a,r),s=new oe.Scene(o,i);s.isReady()?e.onSceneReady(s):s.onReadyObservable.addOnce((function(t){return e.onSceneReady(t)})),o.runRenderLoop((function(){"function"===typeof c&&c(s),s.render()}));var l=function(){s.getEngine().resize()};return window&&window.addEventListener("resize",l),function(){s.getEngine().dispose(),window&&window.removeEventListener("resize",l)}}}),[t]),Object(be.jsx)("canvas",Object(se.a)({ref:t},o))},pe=n(78),de=n(67),he=n(161),Oe=n(160),fe=n(79),ye=(n(247),n(53)),me=(a=Object(ye.type)("number"),r=Object(ye.type)("number"),i=Object(ye.type)("number"),c=function(e){Object(he.a)(n,e);var t=Object(Oe.a)(n);function n(){var e;Object(ie.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(pe.a)(e,"r",o,Object(de.a)(e)),Object(pe.a)(e,"g",s,Object(de.a)(e)),Object(pe.a)(e,"b",l,Object(de.a)(e)),e}return n}(ye.Schema),o=Object(fe.a)(c.prototype,"r",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),s=Object(fe.a)(c.prototype,"g",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),l=Object(fe.a)(c.prototype,"b",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),c),ge=(b=Object(ye.type)("string"),u=Object(ye.type)(me),j=Object(ye.type)("string"),p=function(e){Object(he.a)(n,e);var t=Object(Oe.a)(n);function n(){var e;Object(ie.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(pe.a)(e,"id",d,Object(de.a)(e)),Object(pe.a)(e,"color",h,Object(de.a)(e)),Object(pe.a)(e,"name",O,Object(de.a)(e)),e}return n}(ye.Schema),d=Object(fe.a)(p.prototype,"id",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=Object(fe.a)(p.prototype,"color",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O=Object(fe.a)(p.prototype,"name",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p),ve=(f=Object(ye.type)("number"),y=Object(ye.type)("number"),m=function(e){Object(he.a)(n,e);var t=Object(Oe.a)(n);function n(){var e;Object(ie.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(pe.a)(e,"type",g,Object(de.a)(e)),Object(pe.a)(e,"rotation",v,Object(de.a)(e)),e}return n}(ye.Schema),g=Object(fe.a)(m.prototype,"type",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),v=Object(fe.a)(m.prototype,"rotation",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),m),we=(w=Object(ye.type)("number"),x=Object(ye.type)("number"),k=Object(ye.type)(ve),T=Object(ye.type)([ge]),S=function(e){Object(he.a)(n,e);var t=Object(Oe.a)(n);function n(){var e;Object(ie.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(pe.a)(e,"terrainType",C,Object(de.a)(e)),Object(pe.a)(e,"height",R,Object(de.a)(e)),Object(pe.a)(e,"building",A,Object(de.a)(e)),Object(pe.a)(e,"focusing",z,Object(de.a)(e)),e}return n}(ye.Schema),C=Object(fe.a)(S.prototype,"terrainType",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),R=Object(fe.a)(S.prototype,"height",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),A=Object(fe.a)(S.prototype,"building",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=Object(fe.a)(S.prototype,"focusing",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ye.ArraySchema}}),S),xe=(M=Object(ye.type)("string"),E=Object(ye.type)(me),B=Object(ye.type)("string"),F=function(e){Object(he.a)(n,e);var t=Object(Oe.a)(n);function n(){var e;Object(ie.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(pe.a)(e,"name",N,Object(de.a)(e)),Object(pe.a)(e,"color",I,Object(de.a)(e)),Object(pe.a)(e,"message",P,Object(de.a)(e)),e}return n}(ye.Schema),N=Object(fe.a)(F.prototype,"name",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),I=Object(fe.a)(F.prototype,"color",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=Object(fe.a)(F.prototype,"message",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),F),ke=(H=Object(ye.type)([ge]),D=Object(ye.type)("number"),L=Object(ye.type)("number"),_=Object(ye.type)([we]),W=Object(ye.type)("string"),G=Object(ye.type)([xe]),J=function(e){Object(he.a)(n,e);var t=Object(Oe.a)(n);function n(){var e;Object(ie.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(pe.a)(e,"players",V,Object(de.a)(e)),Object(pe.a)(e,"width",q,Object(de.a)(e)),Object(pe.a)(e,"height",K,Object(de.a)(e)),Object(pe.a)(e,"tiles",U,Object(de.a)(e)),Object(pe.a)(e,"name",X,Object(de.a)(e)),Object(pe.a)(e,"messages",Z,Object(de.a)(e)),e}return n}(ye.Schema),V=Object(fe.a)(J.prototype,"players",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ye.ArraySchema}}),q=Object(fe.a)(J.prototype,"width",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),K=Object(fe.a)(J.prototype,"height",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),U=Object(fe.a)(J.prototype,"tiles",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ye.ArraySchema}}),X=Object(fe.a)(J.prototype,"name",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Z=Object(fe.a)(J.prototype,"messages",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ye.ArraySchema}}),J),Te=(n(219),n(248),[{name:"Grass",color:"#3F9C74",asset:"hex_forest"},{name:"Water",color:"#3EB2BB",asset:"hex_water"},{name:"Sand",color:"#B69169",asset:"hex_sand"},{name:"Dirt",color:"#A76F52",asset:"hex_rock"}]),Se=[{name:"Forest",terrainTypes:[0],asset:"forest1",probability:.2},{name:"Forest with Rock",terrainTypes:[0],asset:"forest2",probability:.2},{name:"Rocks",terrainTypes:[0,2,3],asset:"rocks_small",probability:.1},{name:"Mountain",terrainTypes:[0,2,3],asset:"mountain",probability:.02},{name:"House",terrainTypes:[0,2],asset:"house",probability:.02},{name:"Farm",terrainTypes:[0],asset:"farm_plot",probability:.02},{name:"Mine",terrainTypes:[0,2,3],asset:"mine",probability:.01},{name:"Market",terrainTypes:[0,2,3],asset:"market",probability:.01},{name:"Windmill",terrainTypes:[0,2,3],asset:"mill",probability:.005},{name:"Lumbermill",terrainTypes:[0],asset:"lumbermill",probability:.01},{name:"Barracks",terrainTypes:[0,2,3],asset:"barracks",probability:.01},{name:"Archery Range",terrainTypes:[0,2,3],asset:"archeryrange",probability:.01},{name:"Watchtower",terrainTypes:[0,2,3],asset:"watchtower",probability:.01},{name:"Castle",terrainTypes:[0,2,3],asset:"castle",probability:5e-4},{name:"Bridge",terrainTypes:[1],asset:"bridge",probability:0}];function Ce(e){var t=Object(Q.useState)(0),n=Object(re.a)(t,2),a=n[0],r=n[1],i=Object(Q.useState)(0),c=Object(re.a)(i,2),o=c[0],s=c[1];Object(Q.useEffect)((function(){s(e.tile?e.tile.height:0),e.tile&&e.tile.building&&r(e.tile.building.rotation)}),[e.tile]);return Object(be.jsx)("div",{id:"tile-panel",className:e.tile?"":"hide",children:e.tile?Object(be.jsxs)(be.Fragment,{children:[Object(be.jsx)("div",{id:"terrain-type",children:Te.map((function(t,n){return Object(be.jsx)("button",{onClick:function(){return e.setTerrainType(n)},className:e.tile.terrainType==n?"terrain selected":"terrain",style:{backgroundColor:t.color}},n)}))}),Object(be.jsx)("div",{className:"hr"}),Object(be.jsxs)("div",{id:"height",children:[Object(be.jsx)("div",{children:Object(be.jsx)("label",{htmlFor:"height",children:"Height"})}),Object(be.jsx)("input",{type:"range",step:"0.05",min:"0",max:"2",value:o,onChange:function(t){return function(t){s(t),e.setHeight(t)}(parseFloat(t.target.value))},id:"height"})]}),Object(be.jsx)("div",{className:"hr"}),e.tile.building?Object(be.jsxs)("div",{id:"building",children:[Object(be.jsx)("h3",{children:Se[e.tile.building.type].name}),Object(be.jsx)("div",{children:Object(be.jsx)("label",{htmlFor:"rotation",children:"Rotation"})}),Object(be.jsx)("input",{type:"range",min:"0",max:2*Math.PI,step:.1,value:a,onChange:function(t){return function(t){r(t),e.setRotation(t)}(parseFloat(t.target.value))},id:"rotation"}),Object(be.jsx)("button",{onClick:e.demolishBuilding,children:"Demolish Building"})]}):Object(be.jsxs)("div",{id:"no-building",children:[Object(be.jsx)("h3",{children:"Build"}),Se.map((function(t,n){return t.terrainTypes.includes(e.tile.terrainType)?Object(be.jsx)("button",{onClick:function(){return e.buildBuilding(n)},children:t.name},t.name):Object(be.jsx)(be.Fragment,{})}))]})]}):Object(be.jsx)(be.Fragment,{})})}var Re=function(e){var t=Object(Q.useState)(""),n=Object(re.a)(t,2),a=n[0],r=n[1],i=Object(Q.useRef)(null);return Object(Q.useEffect)((function(){i.current.scrollTop=i.current.scrollHeight}),[e.messages.length]),Object(be.jsxs)("div",{id:"left-panel",children:[Object(be.jsxs)("div",{id:"online-players",children:[Object(be.jsxs)("h3",{id:"player-count",children:["Online Players: ",e.players.length]}),e.players.map((function(e){return Object(be.jsx)("div",{className:"player-name",style:{color:"rgb(".concat(255*e.color.r,",").concat(255*e.color.g,",").concat(255*e.color.b,")")},children:e.name},e.id)}))]}),Object(be.jsx)("div",{className:"hr"}),Object(be.jsxs)("div",{id:"chat",children:[Object(be.jsxs)("div",{id:"messages",ref:i,children:[Object(be.jsx)("h3",{children:"Chat"}),e.messages.map((function(e){return Object(be.jsxs)("div",{className:"message",children:[Object(be.jsx)("span",{className:"player-name",style:{color:"rgb(".concat(255*e.color.r,",").concat(255*e.color.g,",").concat(255*e.color.b,")")},children:e.name}),Object(be.jsx)("span",{children:e.message})]})}))]}),Object(be.jsxs)("form",{id:"chatbox",onSubmit:function(t){t.preventDefault(),a.length>0&&(e.sendMessage(a),r(""))},children:[Object(be.jsx)("input",{autoComplete:"off",type:"text",value:a,onChange:function(e){return r(e.target.value)}}),Object(be.jsx)("button",{children:"Send"})]})]})]})};function Ae(){var e=Object(Q.useState)(!1),t=Object(re.a)(e,2),n=t[0],a=t[1];return Object(be.jsxs)(be.Fragment,{children:[n?Object(be.jsxs)("div",{id:"help-box",children:[Object(be.jsx)("h1",{children:"Island Painter"}),Object(be.jsxs)("p",{children:["Powered by ",Object(be.jsx)("a",{href:"https://babylonjs.com/",children:"Babylon.js"})]}),Object(be.jsxs)("p",{children:["Created by ",Object(be.jsx)("a",{href:"https://twitter.com/DarraghBurke13",children:"Darragh Burke"})]}),Object(be.jsxs)("p",{children:["Get the source at ",Object(be.jsx)("a",{href:"https://github.com/darraghjburke/IslandPainter",children:"GitHub"})," "]}),Object(be.jsxs)("p",{children:["Networking using ",Object(be.jsx)("a",{href:"https://www.colyseus.io/",children:"Colyseus"})]}),Object(be.jsxs)("p",{children:["Assets by ",Object(be.jsx)("a",{href:"https://kaylousberg.itch.io/kaykit-medieval-builder-pack",children:"Kay Lousberg"})," - check out their work!"]}),Object(be.jsxs)("p",{children:["Hex coordinate conversions by ",Object(be.jsx)("a",{href:"https://www.redblobgames.com/grids/hexagons",children:"RedBlobGames"})]}),Object(be.jsxs)("p",{children:["Hand drawn CSS from ",Object(be.jsx)("a",{href:"https://codemyui.com/hand-drawn-border-buttons-css/",children:"CodeMyUI"})]}),Object(be.jsx)("button",{onClick:function(){return a(!1)},children:"X"})]}):Object(be.jsx)(be.Fragment,{}),Object(be.jsx)("button",{onClick:function(){return a(!n)},id:"help-button",children:"?"})]})}var ze=function e(t,n,a){var r=this;Object(ie.a)(this,e),this.parentMesh=void 0,a.addMeshTask("task","","".concat("/IslandPainter","/assets/").concat(t,"/"),"".concat(n,".glb")).onSuccess=function(e){r.parentMesh=e.loadedMeshes[0],r.parentMesh.position.z=1e6}};function Me(e,t){var n=new oe.Color3(0,0,0);e.focusing.forEach((function(t){n.r+=t.color.r/e.focusing.length,n.g+=t.color.g/e.focusing.length,n.b+=t.color.b/e.focusing.length})),t.getChildMeshes().forEach((function(t){0==e.focusing.length?t.renderOutline=!1:(t.renderOutline=!0,t.outlineColor=n,t.outlineWidth=.05)}))}var Ee=function(){var e=Object(Q.useState)(-1),t=Object(re.a)(e,2),n=t[0],a=t[1],r=Object(Q.useState)(new ke),i=Object(re.a)(r,2),c=i[0],o=i[1],s=Y.a.useState({}),l=Object(re.a)(s,2),b=(l[0],l[1]),u=Y.a.useCallback((function(){return b({})}),[]),j=Object(Q.useState)(null),p=Object(re.a)(j,2),d=p[0],h=p[1],O=[],f=[];function y(){return(y=Object(ae.a)(ne.a.mark((function e(t){var n;return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new oe.AssetsManager(t),Te.forEach((function(e){O.push(new ze("tiles",e.asset,n))})),Se.forEach((function(e){f.push(new ze("buildings",e.asset,n))})),e.next=5,n.loadAsync();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){return[1.1*(Math.sqrt(3)*e+Math.sqrt(3)/2*t),1.1*3/2*t]}function g(e){new ce.Client("wss://mamawn.us-west-1.colyseus.dev").joinOrCreate("my_room").then((function(t){h(t),console.log(t.sessionId,"joined",t.name),t.onStateChange((function(e){o(e),u()}));var n=t.state,r=m(12.5,12.5),i=Object(re.a)(r,2),c=i[0],s=i[1];e.cameras[0].target.set(c,2,s),e.cameras[0].radius=40,n.tiles.onAdd=function(t,a){var r=function(e,t){var n=[e%t,Math.floor(e/t)];return m(n[0],n[1])}(a,n.width),i=Object(re.a)(r,2),c=i[0],o=i[1],s=new oe.TransformNode("".concat(a),e);s.position.set(c,t.height,o),s.metadata={key:a};var l=O[t.terrainType].parentMesh.clone("tile",s);l.position.set(0,0,0),l.isPickable=!0;var b=null;t.listen("building",(function(n,a){if(a){var r=oe.Animation.CreateAndStartAnimation("build",b,"position.y",60,10,1,0);r.loopAnimation=!1,r.onAnimationEndObservable.add((function(e){e.target.dispose()}))}n&&((b=new oe.TransformNode("building",e)).parent=s,f[n.type].parentMesh.clone("building",b).position.set(0,0,0),oe.Animation.CreateAndStartAnimation("build",b,"position.y",60,10,0,1).loopAnimation=!1,t.building.listen("rotation",(function(e,n){b.rotation.y=t.building.rotation})),Me(t,s))})),t.listen("terrainType",(function(e,n){null!==n&&l.dispose(),null!==e&&((l=O[t.terrainType].parentMesh.clone("tile",s)).position.set(0,0,0),l.setEnabled(!0),l.isPickable=!0,Me(t,s))})),t.listen("height",(function(e,n){s.position.y=t.height})),t.listen("focusing",(function(){console.log("updating",a),Me(t,s)}))},e.onPointerObservable.add((function(e){var n=-1;if(e.pickInfo&&e.pickInfo.pickedMesh){for(var r=e.pickInfo.pickedMesh;!r.metadata||!r.metadata.key;)if(!(r=r.parent))return;n=r.metadata.key}e.type===oe.PointerEventTypes.POINTERDOWN&&(a(n),t.send("focus",{key:n}))}))})).catch((function(e){console.log("JOIN ERROR",e)}))}return Object(be.jsxs)("div",{children:[Object(be.jsx)(je,{antialias:!0,onSceneReady:function(e){(function(e){return y.apply(this,arguments)})(e).then((function(){return g(e)}));var t=new oe.ArcRotateCamera("camera",0,Math.PI/3,10,new oe.Vector3(0,0,0),e);t.setTarget(oe.Vector3.Zero());var n=e.getEngine().getRenderingCanvas();t.attachControl(n,!0),new oe.HemisphericLight("light",new oe.Vector3(0,1,0),e).intensity=.7},onRender:function(e){},id:"my-canvas"}),Object(be.jsx)(Ce,{tile:c.tiles[n],demolishBuilding:function(){return d.send("demolish",{key:n})},buildBuilding:function(e){return d.send("build",{key:n,type:e})},setTerrainType:function(e){return d.send("changeTerrainType",{key:n,type:e})},setHeight:function(e){return d.send("setHeight",{key:n,height:e})},setRotation:function(e){return d.send("setRotation",{key:n,rotation:e})}}),Object(be.jsx)(Re,{players:c.players,sendMessage:function(e){return d.send("message",{message:e})},messages:c.messages}),Object(be.jsx)("h1",{id:"world-name",children:c.name}),Object(be.jsx)(Ae,{})]})};var Be=function(){return Object(be.jsx)("div",{className:"App",children:Object(be.jsx)(Ee,{})})},Fe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,254)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),i(e),c(e)}))};ee.a.render(Object(be.jsx)(Y.a.StrictMode,{children:Object(be.jsx)(Be,{})}),document.getElementById("root")),Fe()}},[[252,1,2]]]);
//# sourceMappingURL=main.4f9a99a4.chunk.js.map
(this["webpackJsonpreact-client"]=this["webpackJsonpreact-client"]||[]).push([[0],{223:function(e,t,n){},245:function(e,t,n){},253:function(e,t,n){"use strict";n.r(t);var a,r,i,c,o,s,l,b,u,j,p,O,d,h,y,f,m,g,v,w,x,k,T,S,z,C,A,M,R,F,E,B,I,N,P,D,L,_,H,W,J,V,q,G,K,X,Z,Q,U,Y,$,ee,te,ne=n(79),ae=n.n(ne),re=n(237),ie=n.n(re),ce=(n(245),n.p,n(223),n(106)),oe=n(120),se=n(119),le=n(179),be=n.n(le),ue=n(222),je=n(117),pe=n(216),Oe=n(238),de=n(95),he=n(239),ye=n(240),fe=n(30),me=["antialias","engineOptions","adaptToDeviceRatio","sceneOptions","onRender","onSceneReady"],ge=function(e){var t=Object(ne.useRef)(null),n=e.antialias,a=e.engineOptions,r=e.adaptToDeviceRatio,i=e.sceneOptions,c=e.onRender,o=(e.onSceneReady,Object(ye.a)(e,me));return Object(ne.useEffect)((function(){if(t.current){var o=new de.Engine(t.current,n,a,r),s=new de.Scene(o,i);s.isReady()?e.onSceneReady(s):s.onReadyObservable.addOnce((function(t){return e.onSceneReady(t)})),o.runRenderLoop((function(){"function"===typeof c&&c(s),s.render()}));var l=function(){s.getEngine().resize()};return window&&window.addEventListener("resize",l),function(){s.getEngine().dispose(),window&&window.removeEventListener("resize",l)}}}),[t]),Object(fe.jsx)("canvas",Object(he.a)({ref:t},o))},ve=n(68),we=n(63),xe=n(69),ke=(n(248),n(50)),Te=(a=Object(ke.type)("number"),r=Object(ke.type)("number"),i=Object(ke.type)("number"),c=function(e){Object(oe.a)(n,e);var t=Object(se.a)(n);function n(){var e;Object(je.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(ve.a)(e,"x",o,Object(we.a)(e)),Object(ve.a)(e,"y",s,Object(we.a)(e)),Object(ve.a)(e,"z",l,Object(we.a)(e)),e}return n}(ke.Schema),o=Object(xe.a)(c.prototype,"x",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),s=Object(xe.a)(c.prototype,"y",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),l=Object(xe.a)(c.prototype,"z",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),b=Object(ke.type)("number"),u=Object(ke.type)("number"),j=Object(ke.type)("number"),p=function(e){Object(oe.a)(n,e);var t=Object(se.a)(n);function n(){var e;Object(je.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(ve.a)(e,"r",O,Object(we.a)(e)),Object(ve.a)(e,"g",d,Object(we.a)(e)),Object(ve.a)(e,"b",h,Object(we.a)(e)),e}return n}(ke.Schema),O=Object(xe.a)(p.prototype,"r",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),d=Object(xe.a)(p.prototype,"g",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),h=Object(xe.a)(p.prototype,"b",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),p),Se=(y=Object(ke.type)("string"),f=Object(ke.type)(Te),m=Object(ke.type)("string"),g=function(e){Object(oe.a)(n,e);var t=Object(se.a)(n);function n(){var e;Object(je.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(ve.a)(e,"id",v,Object(we.a)(e)),Object(ve.a)(e,"color",w,Object(we.a)(e)),Object(ve.a)(e,"name",x,Object(we.a)(e)),e}return n}(ke.Schema),v=Object(xe.a)(g.prototype,"id",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=Object(xe.a)(g.prototype,"color",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x=Object(xe.a)(g.prototype,"name",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g),ze=(k=Object(ke.type)("number"),T=Object(ke.type)("number"),S=function(e){Object(oe.a)(n,e);var t=Object(se.a)(n);function n(){var e;Object(je.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(ve.a)(e,"type",z,Object(we.a)(e)),Object(ve.a)(e,"rotation",C,Object(we.a)(e)),e}return n}(ke.Schema),z=Object(xe.a)(S.prototype,"type",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C=Object(xe.a)(S.prototype,"rotation",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),S),Ce=(A=Object(ke.type)("number"),M=Object(ke.type)("number"),R=Object(ke.type)(ze),F=function(e){Object(oe.a)(n,e);var t=Object(se.a)(n);function n(){var e;Object(je.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(ve.a)(e,"terrainType",E,Object(we.a)(e)),Object(ve.a)(e,"height",B,Object(we.a)(e)),Object(ve.a)(e,"building",I,Object(we.a)(e)),e}return n}(ke.Schema),E=Object(xe.a)(F.prototype,"terrainType",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),B=Object(xe.a)(F.prototype,"height",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),I=Object(xe.a)(F.prototype,"building",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F),Ae=(N=Object(ke.type)("string"),P=Object(ke.type)(Te),D=Object(ke.type)("string"),L=function(e){Object(oe.a)(n,e);var t=Object(se.a)(n);function n(){var e;Object(je.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(ve.a)(e,"name",_,Object(we.a)(e)),Object(ve.a)(e,"color",H,Object(we.a)(e)),Object(ve.a)(e,"message",W,Object(we.a)(e)),e}return n}(ke.Schema),_=Object(xe.a)(L.prototype,"name",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),H=Object(xe.a)(L.prototype,"color",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W=Object(xe.a)(L.prototype,"message",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),L),Me=(J=Object(ke.type)([Se]),V=Object(ke.type)("number"),q=Object(ke.type)("number"),G=Object(ke.type)([Ce]),K=Object(ke.type)("string"),X=Object(ke.type)([Ae]),Z=function(e){Object(oe.a)(n,e);var t=Object(se.a)(n);function n(){var e;Object(je.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(ve.a)(e,"players",Q,Object(we.a)(e)),Object(ve.a)(e,"width",U,Object(we.a)(e)),Object(ve.a)(e,"height",Y,Object(we.a)(e)),Object(ve.a)(e,"tiles",$,Object(we.a)(e)),Object(ve.a)(e,"name",ee,Object(we.a)(e)),Object(ve.a)(e,"messages",te,Object(we.a)(e)),e}return n}(ke.Schema),Q=Object(xe.a)(Z.prototype,"players",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ke.ArraySchema}}),U=Object(xe.a)(Z.prototype,"width",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),Y=Object(xe.a)(Z.prototype,"height",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),$=Object(xe.a)(Z.prototype,"tiles",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ke.ArraySchema}}),ee=Object(xe.a)(Z.prototype,"name",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),te=Object(xe.a)(Z.prototype,"messages",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ke.ArraySchema}}),Z),Re=(n(221),n(249),[{name:"Grass",color:"#3F9C74",asset:"hex_forest"},{name:"Water",color:"#3EB2BB",asset:"hex_water"},{name:"Sand",color:"#B69169",asset:"hex_sand"},{name:"Dirt",color:"#A76F52",asset:"hex_rock"}]),Fe=[{name:"Forest",terrainTypes:[0],asset:"forest1",probability:.2},{name:"Forest with Rock",terrainTypes:[0],asset:"forest2",probability:.2},{name:"Mountain",terrainTypes:[0,2,3],asset:"mountain",probability:.02},{name:"House",terrainTypes:[0,2],asset:"house",probability:.02},{name:"Farm",terrainTypes:[0],asset:"farm_plot",probability:.02},{name:"Mine",terrainTypes:[0,2,3],asset:"mine",probability:.01},{name:"Market",terrainTypes:[0,2,3],asset:"market",probability:.01},{name:"Windmill",terrainTypes:[0,2,3],asset:"mill",probability:.005},{name:"Lumbermill",terrainTypes:[0],asset:"lumbermill",probability:.01},{name:"Barracks",terrainTypes:[0,2,3],asset:"barracks",probability:.01},{name:"Archery Range",terrainTypes:[0,2,3],asset:"archeryrange",probability:.01},{name:"Watchtower",terrainTypes:[0,2,3],asset:"watchtower",probability:.01},{name:"Castle",terrainTypes:[0,2,3],asset:"castle",probability:5e-4},{name:"Bridge",terrainTypes:[1],asset:"bridge",probability:0}];function Ee(e){var t=Object(ne.useState)(0),n=Object(ce.a)(t,2),a=n[0],r=n[1],i=Object(ne.useState)(0),c=Object(ce.a)(i,2),o=c[0],s=c[1];Object(ne.useEffect)((function(){s(e.tile?e.tile.height:0),e.tile&&e.tile.building&&r(e.tile.building.rotation)}),[e.tile]);return e.tile?Object(fe.jsxs)("div",{id:"tile-panel",children:[Object(fe.jsx)("div",{id:"terrain-type",children:Re.map((function(t,n){return Object(fe.jsx)("button",{onClick:function(){return e.setTerrainType(n)},className:e.tile.terrainType==n?"terrain selected":"terrain",style:{backgroundColor:t.color}})}))}),Object(fe.jsx)("hr",{}),Object(fe.jsxs)("div",{id:"height",children:[Object(fe.jsx)("div",{children:Object(fe.jsx)("label",{htmlFor:"height",children:"Height"})}),Object(fe.jsx)("input",{type:"range",step:"0.05",min:"0",max:"2",value:o,onChange:function(t){return function(t){s(t),e.setHeight(t)}(parseFloat(t.target.value))},id:"height"})]}),Object(fe.jsx)("hr",{}),e.tile.building?Object(fe.jsxs)("div",{id:"building",children:[Object(fe.jsx)("h3",{children:Fe[e.tile.building.type].name}),Object(fe.jsx)("div",{children:Object(fe.jsx)("label",{htmlFor:"rotation",children:"Rotation"})}),Object(fe.jsx)("input",{type:"range",min:"0",max:2*Math.PI,step:.1,value:a,onChange:function(t){return function(t){r(t),e.setRotation(t)}(parseFloat(t.target.value))},id:"rotation"}),Object(fe.jsx)("button",{onClick:e.demolishBuilding,children:"Demolish Building"})]}):Object(fe.jsxs)("div",{id:"no-building",children:[Object(fe.jsx)("h3",{children:"Build"}),Fe.map((function(t,n){return t.terrainTypes.includes(e.tile.terrainType)?Object(fe.jsx)("button",{onClick:function(){return e.buildBuilding(n)},children:t.name}):Object(fe.jsx)(fe.Fragment,{})}))]})]}):Object(fe.jsx)("div",{id:"tile-panel",className:"hide"})}var Be=function(e){var t=Object(ne.useState)(""),n=Object(ce.a)(t,2),a=n[0],r=n[1];console.log("players",e.players);return Object(fe.jsxs)("div",{id:"left-panel",children:[Object(fe.jsxs)("div",{id:"online-players",children:[Object(fe.jsxs)("h3",{id:"player-count",children:["Online Players: ",e.players.length]}),e.players.map((function(e){return Object(fe.jsx)("div",{className:"player-name",style:{color:"rgb(".concat(255*e.color.r,",").concat(255*e.color.g,",").concat(255*e.color.b,")")},children:e.name},e.id)}))]}),Object(fe.jsx)("hr",{}),Object(fe.jsxs)("div",{id:"chat",children:[Object(fe.jsxs)("div",{id:"messages",children:[Object(fe.jsx)("h3",{children:"Chat"}),e.messages.map((function(e){return Object(fe.jsxs)("div",{children:[Object(fe.jsx)("span",{className:"player-name",style:{color:"rgb(".concat(255*e.color.r,",").concat(255*e.color.g,",").concat(255*e.color.b,")")},children:e.name}),Object(fe.jsx)("span",{children:e.message})]})}))]}),Object(fe.jsxs)("form",{id:"chatbox",onSubmit:function(t){t.preventDefault(),e.sendMessage(a),r("")},children:[Object(fe.jsx)("input",{autoComplete:"off",type:"text",value:a,onChange:function(e){return r(e.target.value)}}),Object(fe.jsx)("button",{children:"Send"})]})]})]})};function Ie(){var e=Object(ne.useState)(!1),t=Object(ce.a)(e,2),n=t[0],a=t[1];return Object(fe.jsxs)(fe.Fragment,{children:[n?Object(fe.jsxs)("div",{id:"help-box",children:[Object(fe.jsxs)("p",{children:["Powered by ",Object(fe.jsx)("a",{href:"https://babylonjs.com/",children:"Babylon.js"})]}),Object(fe.jsxs)("p",{children:["Networking using ",Object(fe.jsx)("a",{href:"https://www.colyseus.io/",children:"Colyseus"})]}),Object(fe.jsxs)("p",{children:["Created by ",Object(fe.jsx)("a",{href:"https://twitter.com/DarraghBurke13",children:"Darragh Burke"})]}),Object(fe.jsxs)("p",{children:["Incredible assets by ",Object(fe.jsx)("a",{href:"https://kaylousberg.itch.io/kaykit-medieval-builder-pack",children:"Kay Lousberg"})," - check them out!"]}),Object(fe.jsx)("button",{onClick:function(){return a(!1)},children:"X"})]}):Object(fe.jsx)(fe.Fragment,{}),Object(fe.jsx)("button",{onClick:function(){return a(!n)},id:"help-button",children:"?"})]})}var Ne=function(){function e(t,n){Object(je.a)(this,e),this.parentMesh=void 0,this.loadMesh(t,n)}return Object(pe.a)(e,[{key:"loadMesh",value:function(){var e=Object(ue.a)(be.a.mark((function e(t,n){var a=this;return be.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.addMeshTask("task","","".concat("","/assets/").concat(this.getFolder(),"/"),"".concat(t,".glb")).onSuccess=function(e){a.parentMesh=e.loadedMeshes[0],a.parentMesh.position.z=1e6};case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getFolder",value:function(){return""}}]),e}(),Pe=function(e){Object(oe.a)(n,e);var t=Object(se.a)(n);function n(){return Object(je.a)(this,n),t.apply(this,arguments)}return Object(pe.a)(n,[{key:"getFolder",value:function(){return"tiles"}}]),n}(Ne),De=function(e){Object(oe.a)(n,e);var t=Object(se.a)(n);function n(){return Object(je.a)(this,n),t.apply(this,arguments)}return Object(pe.a)(n,[{key:"getFolder",value:function(){return"buildings"}}]),n}(Ne),Le=function(){var e=Object(ne.useState)(-1),t=Object(ce.a)(e,2),n=t[0],a=t[1],r=Object(ne.useState)(new Me),i=Object(ce.a)(r,2),c=i[0],o=i[1],s=ae.a.useState({}),l=Object(ce.a)(s,2),b=(l[0],l[1]),u=ae.a.useCallback((function(){return b({})}),[]),j=Object(ne.useState)(null),p=Object(ce.a)(j,2),O=p[0],d=p[1],h=[],y=[];function f(){return(f=Object(ue.a)(be.a.mark((function e(t){var n;return be.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new de.AssetsManager(t),Re.forEach((function(e){h.push(new Pe(e.asset,n))})),Fe.forEach((function(e){y.push(new De(e.asset,n))})),e.next=5,n.loadAsync();case 5:g(t);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){return[1.1*(Math.sqrt(3)*e+Math.sqrt(3)/2*t),1.1*3/2*t]}function g(e){new Oe.Client("https://mamawn.us-west-1.colyseus.dev/matchmake/joinOrCreate/my_room").joinOrCreate("my_room").then((function(t){d(t),console.log(t.sessionId,"joined",t.name),t.onStateChange((function(e){o(e),u()}));var n=t.state,r=m(12.5,12.5),i=Object(ce.a)(r,2),c=i[0],s=i[1];e.cameras[0].target.set(c,2,s),e.cameras[0].radius=40,n.tiles.onAdd=function(t,a){console.log(t,a);var r=function(e,t){var n=[e%t,Math.floor(e/t)];return m(n[0],n[1])}(a,n.width),i=Object(ce.a)(r,2),c=i[0],o=i[1],s=new de.TransformNode("".concat(a),e);s.position.set(c,t.height,o),s.metadata={key:a};var l=h[t.terrainType].parentMesh.clone("tile",s);l.position.set(0,0,0),l.setEnabled(!0),l.isPickable=!0;var b=null,u=null;t.listen("building",(function(n,a){if(a){var r=de.Animation.CreateAndStartAnimation("build",b,"position.y",60,10,1,0);r.loopAnimation=!1,r.onAnimationEndObservable.add((function(e){e.target.dispose()}))}n&&((b=new de.TransformNode("building",e)).parent=s,(u=y[n.type].parentMesh.clone("building",b)).position.set(0,0,0),u.setEnabled(!0),de.Animation.CreateAndStartAnimation("build",b,"position.y",60,10,0,1).loopAnimation=!1,t.building.listen("rotation",(function(e,n){b.rotation.y=t.building.rotation})))})),t.listen("terrainType",(function(e,n){n&&l.dispose(),e&&((l=h[t.terrainType].parentMesh.clone("tile",s)).position.set(0,0,0),l.setEnabled(!0),l.isPickable=!0)})),t.listen("height",(function(e,n){s.position.y=t.height}))},e.onPointerObservable.add((function(e){if(e.type==de.PointerEventTypes.POINTERDOWN)if(e.pickInfo&&e.pickInfo.pickedMesh){for(var t=e.pickInfo.pickedMesh;!t.metadata||!t.metadata.key;)t=t.parent;if(e.pickInfo&&e.pickInfo.pickedMesh){for(var n=e.pickInfo.pickedMesh;!n.metadata||!n.metadata.key;)if(!(n=n.parent))return;a(n.metadata.key)}}else a(-1)}))})).catch((function(e){console.log("JOIN ERROR",e)}))}return console.log(c.players),Object(fe.jsxs)("div",{children:[Object(fe.jsx)(ge,{antialias:!0,onSceneReady:function(e){!function(e){f.apply(this,arguments)}(e);var t=new de.ArcRotateCamera("my first camera",0,Math.PI/3,10,new de.Vector3(0,0,0),e);t.setTarget(de.Vector3.Zero());var n=e.getEngine().getRenderingCanvas();t.attachControl(n,!0),new de.HemisphericLight("light",new de.Vector3(0,1,0),e).intensity=.7},onRender:function(e){},id:"my-canvas"}),Object(fe.jsx)(Ee,{tile:c.tiles[n],demolishBuilding:function(){return O.send("demolish",{key:n})},buildBuilding:function(e){return O.send("build",{key:n,type:e})},setTerrainType:function(e){return O.send("changeTerrainType",{key:n,type:e})},setHeight:function(e){return O.send("setHeight",{key:n,height:e})},setRotation:function(e){return O.send("setRotation",{key:n,rotation:e})}}),Object(fe.jsx)(Be,{players:c.players,sendMessage:function(e){return O.send("message",{message:e})},messages:c.messages}),Object(fe.jsx)("h1",{id:"world-name",children:c.name}),Object(fe.jsx)(Ie,{})]})};var _e=function(){return Object(fe.jsx)("div",{className:"App",children:Object(fe.jsx)(Le,{})})},He=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,255)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),i(e),c(e)}))};ie.a.render(Object(fe.jsx)(ae.a.StrictMode,{children:Object(fe.jsx)(_e,{})}),document.getElementById("root")),He()}},[[253,1,2]]]);
//# sourceMappingURL=main.68ec1af0.chunk.js.map
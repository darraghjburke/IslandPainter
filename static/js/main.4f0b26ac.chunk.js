(this["webpackJsonpisland-painter"]=this["webpackJsonpisland-painter"]||[]).push([[0],{223:function(e,t,n){},247:function(e,t,n){},255:function(e,t,n){"use strict";n.r(t);var a,r,i,c,o,s,l,b,u,j,p,d,h,O,f,y,m,g,v,w,x,k,T,S,C,R,A,z,M,E,B,F,N,I,P,H,D,L,_,W,G,J,V,q,K,U,X,Z,Q=n(70),Y=n.n(Q),$=n(237),ee=n.n($),te=(n(247),n.p,n(223),n(222)),ne=n.n(te),ae=n(240),re=n(238),ie=n(106),ce=n(140),oe=n(239),se=n(93),le=n(241),be=n(242),ue=n(28),je=["antialias","engineOptions","adaptToDeviceRatio","sceneOptions","onRender","onSceneReady"],pe=function(e){var t=Object(Q.useRef)(null),n=e.antialias,a=e.engineOptions,r=e.adaptToDeviceRatio,i=e.sceneOptions,c=e.onRender,o=(e.onSceneReady,Object(be.a)(e,je));return Object(Q.useEffect)((function(){if(t.current){var o=new se.Engine(t.current,n,a,r),s=new se.Scene(o,i);s.isReady()?e.onSceneReady(s):s.onReadyObservable.addOnce((function(t){return e.onSceneReady(t)})),o.runRenderLoop((function(){"function"===typeof c&&c(s),s.render()}));var l=function(){s.getEngine().resize()};return window&&window.addEventListener("resize",l),function(){s.getEngine().dispose(),window&&window.removeEventListener("resize",l)}}}),[t]),Object(ue.jsx)("canvas",Object(le.a)({ref:t},o))},de=n(78),he=n(67),Oe=n(161),fe=n(160),ye=n(79),me=(n(250),n(53)),ge=(a=Object(me.type)("number"),r=Object(me.type)("number"),i=Object(me.type)("number"),c=function(e){Object(Oe.a)(n,e);var t=Object(fe.a)(n);function n(){var e;Object(ce.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(de.a)(e,"r",o,Object(he.a)(e)),Object(de.a)(e,"g",s,Object(he.a)(e)),Object(de.a)(e,"b",l,Object(he.a)(e)),e}return n}(me.Schema),o=Object(ye.a)(c.prototype,"r",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),s=Object(ye.a)(c.prototype,"g",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),l=Object(ye.a)(c.prototype,"b",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),c),ve=(b=Object(me.type)("string"),u=Object(me.type)(ge),j=Object(me.type)("string"),p=function(e){Object(Oe.a)(n,e);var t=Object(fe.a)(n);function n(){var e;Object(ce.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(de.a)(e,"id",d,Object(he.a)(e)),Object(de.a)(e,"color",h,Object(he.a)(e)),Object(de.a)(e,"name",O,Object(he.a)(e)),e}return n}(me.Schema),d=Object(ye.a)(p.prototype,"id",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=Object(ye.a)(p.prototype,"color",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O=Object(ye.a)(p.prototype,"name",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p),we=(f=Object(me.type)("number"),y=Object(me.type)("number"),m=function(e){Object(Oe.a)(n,e);var t=Object(fe.a)(n);function n(){var e;Object(ce.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(de.a)(e,"type",g,Object(he.a)(e)),Object(de.a)(e,"rotation",v,Object(he.a)(e)),e}return n}(me.Schema),g=Object(ye.a)(m.prototype,"type",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),v=Object(ye.a)(m.prototype,"rotation",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),m),xe=(w=Object(me.type)("number"),x=Object(me.type)("number"),k=Object(me.type)(we),T=Object(me.type)([ve]),S=function(e){Object(Oe.a)(n,e);var t=Object(fe.a)(n);function n(){var e;Object(ce.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(de.a)(e,"terrainType",C,Object(he.a)(e)),Object(de.a)(e,"height",R,Object(he.a)(e)),Object(de.a)(e,"building",A,Object(he.a)(e)),Object(de.a)(e,"focusing",z,Object(he.a)(e)),e}return n}(me.Schema),C=Object(ye.a)(S.prototype,"terrainType",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),R=Object(ye.a)(S.prototype,"height",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),A=Object(ye.a)(S.prototype,"building",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=Object(ye.a)(S.prototype,"focusing",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new me.ArraySchema}}),S),ke=(M=Object(me.type)("string"),E=Object(me.type)(ge),B=Object(me.type)("string"),F=function(e){Object(Oe.a)(n,e);var t=Object(fe.a)(n);function n(){var e;Object(ce.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(de.a)(e,"name",N,Object(he.a)(e)),Object(de.a)(e,"color",I,Object(he.a)(e)),Object(de.a)(e,"message",P,Object(he.a)(e)),e}return n}(me.Schema),N=Object(ye.a)(F.prototype,"name",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),I=Object(ye.a)(F.prototype,"color",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=Object(ye.a)(F.prototype,"message",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),F),Te=(H=Object(me.type)([ve]),D=Object(me.type)("number"),L=Object(me.type)("number"),_=Object(me.type)([xe]),W=Object(me.type)("string"),G=Object(me.type)([ke]),J=function(e){Object(Oe.a)(n,e);var t=Object(fe.a)(n);function n(){var e;Object(ce.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return e=t.call.apply(t,[this].concat(r)),Object(de.a)(e,"players",V,Object(he.a)(e)),Object(de.a)(e,"width",q,Object(he.a)(e)),Object(de.a)(e,"height",K,Object(he.a)(e)),Object(de.a)(e,"tiles",U,Object(he.a)(e)),Object(de.a)(e,"name",X,Object(he.a)(e)),Object(de.a)(e,"messages",Z,Object(he.a)(e)),e}return n}(me.Schema),V=Object(ye.a)(J.prototype,"players",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new me.ArraySchema}}),q=Object(ye.a)(J.prototype,"width",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),K=Object(ye.a)(J.prototype,"height",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),U=Object(ye.a)(J.prototype,"tiles",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new me.ArraySchema}}),X=Object(ye.a)(J.prototype,"name",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Z=Object(ye.a)(J.prototype,"messages",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new me.ArraySchema}}),J),Se=(n(221),n(251),[{name:"Grass",color:"#3F9C74",asset:"hex_forest"},{name:"Water",color:"#3EB2BB",asset:"hex_water"},{name:"Sand",color:"#B69169",asset:"hex_sand"},{name:"Dirt",color:"#A76F52",asset:"hex_rock"}]),Ce=[{name:"Forest",terrainTypes:[0],asset:"forest1",probability:.2},{name:"Forest with Rock",terrainTypes:[0],asset:"forest2",probability:.2},{name:"Rocks",terrainTypes:[0,2,3],asset:"rocks_small",probability:.1},{name:"Mountain",terrainTypes:[0,2,3],asset:"mountain",probability:.02},{name:"House",terrainTypes:[0,2],asset:"house",probability:.02},{name:"Farm",terrainTypes:[0],asset:"farm_plot",probability:.02},{name:"Mine",terrainTypes:[0,2,3],asset:"mine",probability:.01},{name:"Market",terrainTypes:[0,2,3],asset:"market",probability:.01},{name:"Windmill",terrainTypes:[0,2,3],asset:"mill",probability:.005},{name:"Lumbermill",terrainTypes:[0],asset:"lumbermill",probability:.01},{name:"Barracks",terrainTypes:[0,2,3],asset:"barracks",probability:.01},{name:"Archery Range",terrainTypes:[0,2,3],asset:"archeryrange",probability:.01},{name:"Watchtower",terrainTypes:[0,2,3],asset:"watchtower",probability:.01},{name:"Castle",terrainTypes:[0,2,3],asset:"castle",probability:5e-4},{name:"Bridge",terrainTypes:[1],asset:"bridge",probability:0}];function Re(e){var t=Object(Q.useState)(0),n=Object(ie.a)(t,2),a=n[0],r=n[1],i=Object(Q.useState)(0),c=Object(ie.a)(i,2),o=c[0],s=c[1];Object(Q.useEffect)((function(){s(e.tile?e.tile.height:0),e.tile&&e.tile.building&&r(e.tile.building.rotation)}),[e.tile]);return Object(ue.jsx)("div",{id:"tile-panel",className:e.tile?"":"hide",children:e.tile?Object(ue.jsxs)(ue.Fragment,{children:[Object(ue.jsx)("div",{id:"terrain-type",children:Se.map((function(t,n){return Object(ue.jsx)("button",{onClick:function(){return e.setTerrainType(n)},className:e.tile.terrainType==n?"terrain selected":"terrain",style:{backgroundColor:t.color}},n)}))}),Object(ue.jsx)("div",{className:"hr"}),Object(ue.jsxs)("div",{id:"height",children:[Object(ue.jsx)("div",{children:Object(ue.jsx)("label",{htmlFor:"height",children:"Height"})}),Object(ue.jsx)("input",{type:"range",step:"0.05",min:"0",max:"2",value:o,onChange:function(t){return function(t){s(t),e.setHeight(t)}(parseFloat(t.target.value))},id:"height"})]}),Object(ue.jsx)("div",{className:"hr"}),e.tile.building?Object(ue.jsxs)("div",{id:"building",children:[Object(ue.jsx)("h3",{children:Ce[e.tile.building.type].name}),Object(ue.jsx)("div",{children:Object(ue.jsx)("label",{htmlFor:"rotation",children:"Rotation"})}),Object(ue.jsx)("input",{type:"range",min:"0",max:2*Math.PI,step:.1,value:a,onChange:function(t){return function(t){r(t),e.setRotation(t)}(parseFloat(t.target.value))},id:"rotation"}),Object(ue.jsx)("button",{onClick:e.demolishBuilding,children:"Demolish Building"})]}):Object(ue.jsxs)("div",{id:"no-building",children:[Object(ue.jsx)("h3",{children:"Build"}),Ce.map((function(t,n){return t.terrainTypes.includes(e.tile.terrainType)?Object(ue.jsx)("button",{onClick:function(){return e.buildBuilding(n)},children:t.name},t.name):Object(ue.jsx)(ue.Fragment,{})}))]})]}):Object(ue.jsx)(ue.Fragment,{})})}var Ae=function(e){var t=Object(Q.useState)(""),n=Object(ie.a)(t,2),a=n[0],r=n[1],i=Object(Q.useRef)(null);return Object(Q.useEffect)((function(){i.current.scrollTop=i.current.scrollHeight}),[e.messages.length]),Object(ue.jsxs)("div",{id:"left-panel",children:[Object(ue.jsxs)("div",{id:"online-players",children:[Object(ue.jsxs)("h3",{id:"player-count",children:["Online Players: ",e.players.length]}),e.players.map((function(e){return Object(ue.jsx)("div",{className:"player-name",style:{color:"rgb(".concat(255*e.color.r,",").concat(255*e.color.g,",").concat(255*e.color.b,")")},children:e.name},e.id)}))]}),Object(ue.jsx)("div",{className:"hr"}),Object(ue.jsxs)("div",{id:"chat",children:[Object(ue.jsxs)("div",{id:"messages",ref:i,children:[Object(ue.jsx)("h3",{children:"Chat"}),e.messages.map((function(e){return Object(ue.jsxs)("div",{className:"message",children:[Object(ue.jsx)("span",{className:"player-name",style:{color:"rgb(".concat(255*e.color.r,",").concat(255*e.color.g,",").concat(255*e.color.b,")")},children:e.name}),Object(ue.jsx)("span",{children:e.message})]})}))]}),Object(ue.jsxs)("form",{id:"chatbox",onSubmit:function(t){t.preventDefault(),a.length>0&&(e.sendMessage(a),r(""))},children:[Object(ue.jsx)("input",{autoComplete:"off",type:"text",value:a,onChange:function(e){return r(e.target.value)}}),Object(ue.jsx)("button",{children:"Send"})]})]})]})};function ze(){var e=Object(Q.useState)(!1),t=Object(ie.a)(e,2),n=t[0],a=t[1];return Object(ue.jsxs)(ue.Fragment,{children:[n?Object(ue.jsxs)("div",{id:"help-box",children:[Object(ue.jsx)("h1",{children:"Island Painter"}),Object(ue.jsxs)("p",{children:["Powered by ",Object(ue.jsx)("a",{href:"https://babylonjs.com/",children:"Babylon.js"})]}),Object(ue.jsxs)("p",{children:["Created by ",Object(ue.jsx)("a",{href:"https://twitter.com/DarraghBurke13",children:"Darragh Burke"})]}),Object(ue.jsxs)("p",{children:["Get the source at ",Object(ue.jsx)("a",{href:"https://github.com/darraghjburke/IslandPainter",children:"GitHub"})," "]}),Object(ue.jsxs)("p",{children:["Networking using ",Object(ue.jsx)("a",{href:"https://www.colyseus.io/",children:"Colyseus"})]}),Object(ue.jsxs)("p",{children:["Assets by ",Object(ue.jsx)("a",{href:"https://kaylousberg.itch.io/kaykit-medieval-builder-pack",children:"Kay Lousberg"})," - check out their work!"]}),Object(ue.jsxs)("p",{children:["Hex coordinate conversions by ",Object(ue.jsx)("a",{href:"https://www.redblobgames.com/grids/hexagons",children:"RedBlobGames"})]}),Object(ue.jsxs)("p",{children:["Hand drawn CSS from ",Object(ue.jsx)("a",{href:"https://codemyui.com/hand-drawn-border-buttons-css/",children:"CodeMyUI"})]}),Object(ue.jsx)("button",{onClick:function(){return a(!1)},children:"X"})]}):Object(ue.jsx)(ue.Fragment,{}),Object(ue.jsx)("button",{onClick:function(){return a(!n)},id:"help-button",children:"?"})]})}var Me=function e(t,n,a){var r=this;Object(ce.a)(this,e),this.parentMesh=void 0,a.addMeshTask("task","","".concat("/IslandPainter","/assets/").concat(t,"/"),"".concat(n,".glb")).onSuccess=function(e){r.parentMesh=e.loadedMeshes[0],r.parentMesh.position.z=1e6}};function Ee(e,t){var n=new se.Color3(0,0,0);e.focusing.forEach((function(t){n.r+=t.color.r/e.focusing.length,n.g+=t.color.g/e.focusing.length,n.b+=t.color.b/e.focusing.length})),t.getChildMeshes().forEach((function(t){0==e.focusing.length?t.renderOutline=!1:(t.renderOutline=!0,t.outlineColor=n,t.outlineWidth=.05)}))}var Be=function(){var e=Object(Q.useState)(-1),t=Object(ie.a)(e,2),n=t[0],a=t[1],r=Object(Q.useState)(new Te),i=Object(ie.a)(r,2),c=i[0],o=i[1],s=Y.a.useState({}),l=Object(ie.a)(s,2),b=(l[0],l[1]),u=Y.a.useCallback((function(){return b({})}),[]),j=Object(Q.useState)(null),p=Object(ie.a)(j,2),d=p[0],h=p[1],O=[],f=[];function y(){return(y=Object(re.a)(ne.a.mark((function e(t){var n;return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new se.AssetsManager(t),Se.forEach((function(e){O.push(new Me("tiles",e.asset,n))})),Ce.forEach((function(e){f.push(new Me("buildings",e.asset,n))})),e.next=5,n.loadAsync();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){return g.apply(void 0,Object(ae.a)(function(e,t){return[e%t,Math.floor(e/t)]}(e,t)))}function g(e,t){return[1.1*(Math.sqrt(3)*e+Math.sqrt(3)/2*t),1.1*3/2*t]}return Object(ue.jsxs)("div",{children:[Object(ue.jsx)(pe,{antialias:!0,onSceneReady:function(e){(function(e){return y.apply(this,arguments)})(e).then((function(){return function(e){new oe.Client("wss://mamawn.us-west-1.colyseus.dev").joinOrCreate("my_room").then((function(t){h(t),console.log(t.sessionId,"joined",t.name),t.onStateChange((function(e){o(e),u()}));var n=t.state,r=g(12.5,12.5),i=Object(ie.a)(r,2),c=i[0],s=i[1];e.cameras[0].target.set(c,2,s),e.cameras[0].radius=40,n.tiles.onAdd=function(t,a){var r=m(a,n.width),i=Object(ie.a)(r,2),c=i[0],o=i[1],s=new se.TransformNode("".concat(a),e);s.position.set(c,t.height,o),s.metadata={key:a};var l=O[t.terrainType].parentMesh.clone("tile",s);l.position.set(0,0,0),l.isPickable=!0;var b=null;t.listen("building",(function(n,a){if(a){var r=se.Animation.CreateAndStartAnimation("build",b,"position.y",60,10,1,0);r.loopAnimation=!1,r.onAnimationEndObservable.add((function(e){e.target.dispose()}))}n&&((b=new se.TransformNode("building",e)).parent=s,f[n.type].parentMesh.clone("building",b).position.set(0,0,0),se.Animation.CreateAndStartAnimation("build",b,"position.y",60,10,0,1).loopAnimation=!1,t.building.listen("rotation",(function(e,n){b.rotation.y=t.building.rotation})),Ee(t,s))})),t.listen("terrainType",(function(e,n){null!==n&&l.dispose(),null!==e&&((l=O[t.terrainType].parentMesh.clone("tile",s)).position.set(0,0,0),l.setEnabled(!0),l.isPickable=!0,Ee(t,s))})),t.listen("height",(function(e,n){s.position.y=t.height})),t.listen("focusing",(function(){Ee(t,s)}))},e.onPointerObservable.add((function(e){var r=-1;if(e.pickInfo&&e.pickInfo.pickedMesh){for(var i=e.pickInfo.pickedMesh;!i.metadata||!i.metadata.key;)if(!(i=i.parent))return;r=i.metadata.key}e.type===se.PointerEventTypes.POINTERDOWN&&(-1!=r&&0!=n.tiles[r].focusing.length||(a(r),t.send("focus",{key:r})))}))})).catch((function(e){console.log("JOIN ERROR",e)}))}(e)}));var t=new se.ArcRotateCamera("camera",0,Math.PI/3,10,new se.Vector3(0,0,0),e);t.setTarget(se.Vector3.Zero());var n=e.getEngine().getRenderingCanvas();t.attachControl(n,!0),new se.HemisphericLight("light",new se.Vector3(0,1,0),e).intensity=.7},onRender:function(e){},id:"my-canvas"}),Object(ue.jsx)(Re,{tile:c.tiles[n],demolishBuilding:function(){return d.send("demolish",{key:n})},buildBuilding:function(e){return d.send("build",{key:n,type:e})},setTerrainType:function(e){return d.send("changeTerrainType",{key:n,type:e})},setHeight:function(e){return d.send("setHeight",{key:n,height:e})},setRotation:function(e){return d.send("setRotation",{key:n,rotation:e})}}),Object(ue.jsx)(Ae,{players:c.players,sendMessage:function(e){return d.send("message",{message:e})},messages:c.messages}),Object(ue.jsx)("h1",{id:"world-name",children:c.name}),Object(ue.jsx)(ze,{})]})};var Fe=function(){return Object(ue.jsx)("div",{className:"App",children:Object(ue.jsx)(Be,{})})},Ne=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,257)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),i(e),c(e)}))};ee.a.render(Object(ue.jsx)(Y.a.StrictMode,{children:Object(ue.jsx)(Fe,{})}),document.getElementById("root")),Ne()}},[[255,1,2]]]);
//# sourceMappingURL=main.4f0b26ac.chunk.js.map
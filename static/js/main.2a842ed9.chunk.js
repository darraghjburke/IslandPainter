(this["webpackJsonpisland-painter"]=this["webpackJsonpisland-painter"]||[]).push([[0],{223:function(e,t,n){},247:function(e,t,n){},255:function(e,t,n){"use strict";n.r(t);var a,i,r,c,o,s,l,b,u,j,d,h,p,O,f,m,g,y,v,w,x,k,T,C,S,R,A,z,B,N,E,F,M,P,I,H,L,D,_,W,G,J,V,q,Z,K,U,X,Y=n(70),Q=n.n(Y),$=n(237),ee=n.n($),te=(n(247),n.p,n(223),n(222)),ne=n.n(te),ae=n(240),ie=n(238),re=n(106),ce=n(140),oe=n(239),se=n(91),le=n(241),be=n(242),ue=n(28),je=["antialias","engineOptions","adaptToDeviceRatio","sceneOptions","onRender","onSceneReady"],de=function(e){var t=Object(Y.useRef)(null),n=e.antialias,a=e.engineOptions,i=e.adaptToDeviceRatio,r=e.sceneOptions,c=e.onRender,o=(e.onSceneReady,Object(be.a)(e,je));return Object(Y.useEffect)((function(){if(t.current){var o=new se.Engine(t.current,n,a,i),s=new se.Scene(o,r);s.isReady()?e.onSceneReady(s):s.onReadyObservable.addOnce((function(t){return e.onSceneReady(t)})),o.runRenderLoop((function(){"function"===typeof c&&c(s),s.render()}));var l=function(){s.getEngine().resize()};return window&&window.addEventListener("resize",l),function(){s.getEngine().dispose(),window&&window.removeEventListener("resize",l)}}}),[t]),Object(ue.jsx)("canvas",Object(le.a)({ref:t},o))},he=n(78),pe=n(67),Oe=n(161),fe=n(160),me=n(79),ge=(n(250),n(53)),ye=(a=Object(ge.type)("number"),i=Object(ge.type)("number"),r=Object(ge.type)("number"),c=function(e){Object(Oe.a)(n,e);var t=Object(fe.a)(n);function n(){var e;Object(ce.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i)),Object(he.a)(e,"r",o,Object(pe.a)(e)),Object(he.a)(e,"g",s,Object(pe.a)(e)),Object(he.a)(e,"b",l,Object(pe.a)(e)),e}return n}(ge.Schema),o=Object(me.a)(c.prototype,"r",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),s=Object(me.a)(c.prototype,"g",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),l=Object(me.a)(c.prototype,"b",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),c),ve=(b=Object(ge.type)("string"),u=Object(ge.type)(ye),j=Object(ge.type)("string"),d=function(e){Object(Oe.a)(n,e);var t=Object(fe.a)(n);function n(){var e;Object(ce.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i)),Object(he.a)(e,"id",h,Object(pe.a)(e)),Object(he.a)(e,"color",p,Object(pe.a)(e)),Object(he.a)(e,"name",O,Object(pe.a)(e)),e}return n}(ge.Schema),h=Object(me.a)(d.prototype,"id",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p=Object(me.a)(d.prototype,"color",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O=Object(me.a)(d.prototype,"name",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d),we=(f=Object(ge.type)("number"),m=Object(ge.type)("number"),g=function(e){Object(Oe.a)(n,e);var t=Object(fe.a)(n);function n(){var e;Object(ce.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i)),Object(he.a)(e,"type",y,Object(pe.a)(e)),Object(he.a)(e,"rotation",v,Object(pe.a)(e)),e}return n}(ge.Schema),y=Object(me.a)(g.prototype,"type",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),v=Object(me.a)(g.prototype,"rotation",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),g),xe=(w=Object(ge.type)("number"),x=Object(ge.type)("number"),k=Object(ge.type)(we),T=Object(ge.type)([ve]),C=function(e){Object(Oe.a)(n,e);var t=Object(fe.a)(n);function n(){var e;Object(ce.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i)),Object(he.a)(e,"terrainType",S,Object(pe.a)(e)),Object(he.a)(e,"height",R,Object(pe.a)(e)),Object(he.a)(e,"building",A,Object(pe.a)(e)),Object(he.a)(e,"focusing",z,Object(pe.a)(e)),e}return n}(ge.Schema),S=Object(me.a)(C.prototype,"terrainType",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),R=Object(me.a)(C.prototype,"height",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),A=Object(me.a)(C.prototype,"building",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=Object(me.a)(C.prototype,"focusing",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge.ArraySchema}}),C),ke=(B=Object(ge.type)("string"),N=Object(ge.type)(ye),E=Object(ge.type)("string"),F=function(e){Object(Oe.a)(n,e);var t=Object(fe.a)(n);function n(){var e;Object(ce.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i)),Object(he.a)(e,"name",M,Object(pe.a)(e)),Object(he.a)(e,"color",P,Object(pe.a)(e)),Object(he.a)(e,"message",I,Object(pe.a)(e)),e}return n}(ge.Schema),M=Object(me.a)(F.prototype,"name",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),P=Object(me.a)(F.prototype,"color",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=Object(me.a)(F.prototype,"message",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),F),Te=(H=Object(ge.type)([ve]),L=Object(ge.type)("number"),D=Object(ge.type)("number"),_=Object(ge.type)([xe]),W=Object(ge.type)("string"),G=Object(ge.type)([ke]),J=function(e){Object(Oe.a)(n,e);var t=Object(fe.a)(n);function n(){var e;Object(ce.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i)),Object(he.a)(e,"players",V,Object(pe.a)(e)),Object(he.a)(e,"width",q,Object(pe.a)(e)),Object(he.a)(e,"height",Z,Object(pe.a)(e)),Object(he.a)(e,"tiles",K,Object(pe.a)(e)),Object(he.a)(e,"name",U,Object(pe.a)(e)),Object(he.a)(e,"messages",X,Object(pe.a)(e)),e}return n}(ge.Schema),V=Object(me.a)(J.prototype,"players",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge.ArraySchema}}),q=Object(me.a)(J.prototype,"width",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),Z=Object(me.a)(J.prototype,"height",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),K=Object(me.a)(J.prototype,"tiles",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge.ArraySchema}}),U=Object(me.a)(J.prototype,"name",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),X=Object(me.a)(J.prototype,"messages",[G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ge.ArraySchema}}),J),Ce=(n(221),n(251),[{name:"Grass",color:"#3F9C74",asset:"hex_forest"},{name:"Water",color:"#3EB2BB",asset:"hex_water"},{name:"Sand",color:"#B69169",asset:"hex_sand"},{name:"Dirt",color:"#A76F52",asset:"hex_rock"}]),Se=[{name:"Forest",terrainTypes:[0],asset:"forest1",probability:.2},{name:"Forest with Rock",terrainTypes:[0],asset:"forest2",probability:.2},{name:"Rocks",terrainTypes:[0,2,3],asset:"rocks_small",probability:.1},{name:"Mountain",terrainTypes:[0,2,3],asset:"mountain",probability:.02},{name:"House",terrainTypes:[0,2],asset:"house",probability:.02},{name:"Farm",terrainTypes:[0],asset:"farm_plot",probability:.02},{name:"Mine",terrainTypes:[0,2,3],asset:"mine",probability:.01},{name:"Market",terrainTypes:[0,2,3],asset:"market",probability:.01},{name:"Windmill",terrainTypes:[0,2,3],asset:"mill",probability:.005},{name:"Lumbermill",terrainTypes:[0],asset:"lumbermill",probability:.01},{name:"Barracks",terrainTypes:[0,2,3],asset:"barracks",probability:.01},{name:"Archery Range",terrainTypes:[0,2,3],asset:"archeryrange",probability:.01},{name:"Watchtower",terrainTypes:[0,2,3],asset:"watchtower",probability:.01},{name:"Castle",terrainTypes:[0,2,3],asset:"castle",probability:5e-4},{name:"Bridge",terrainTypes:[1],asset:"bridge",probability:0}];function Re(e){var t=Object(Y.useState)(0),n=Object(re.a)(t,2),a=n[0],i=n[1],r=Object(Y.useState)(0),c=Object(re.a)(r,2),o=c[0],s=c[1];Object(Y.useEffect)((function(){s(e.tile?e.tile.height:0),e.tile&&e.tile.building&&i(e.tile.building.rotation)}),[e.tile]);return Object(ue.jsx)("div",{id:"tile-panel",className:e.tile?"":"hide",children:e.tile?Object(ue.jsxs)(ue.Fragment,{children:[Object(ue.jsxs)("div",{id:"terrain-type",children:[Ce.map((function(t,n){return Object(ue.jsx)("button",{onClick:function(){return e.setTerrainType(n)},className:e.tile.terrainType==n?"terrain selected":"terrain",style:{backgroundColor:t.color}},n)})),Object(ue.jsx)("h3",{children:Ce[e.tile.terrainType].name})]}),Object(ue.jsxs)("div",{id:"height",children:[Object(ue.jsx)("div",{children:Object(ue.jsx)("label",{htmlFor:"height",children:"Height"})}),Object(ue.jsx)("input",{type:"range",step:"0.05",min:"0",max:"2",value:o,onChange:function(t){return function(t){s(t),e.setHeight(t)}(parseFloat(t.target.value))},id:"height"})]}),Object(ue.jsx)("div",{className:"hr"}),e.tile.building?Object(ue.jsxs)("div",{id:"building",children:[Object(ue.jsx)("h3",{children:Se[e.tile.building.type].name}),Object(ue.jsx)("div",{children:Object(ue.jsx)("label",{htmlFor:"rotation",children:"Rotation"})}),Object(ue.jsx)("input",{type:"range",min:"0",max:2*Math.PI,step:.1,value:a,onChange:function(t){return function(t){i(t),e.setRotation(t)}(parseFloat(t.target.value))},id:"rotation"}),Object(ue.jsx)("button",{onClick:e.demolishBuilding,children:"Demolish"})]}):Object(ue.jsxs)("div",{id:"no-building",children:[Object(ue.jsx)("h3",{children:"Build"}),Se.map((function(t,n){return t.terrainTypes.includes(e.tile.terrainType)?Object(ue.jsx)("button",{onClick:function(){return e.buildBuilding(n)},children:t.name},t.name):Object(ue.jsx)(ue.Fragment,{})}))]})]}):Object(ue.jsx)(ue.Fragment,{})})}var Ae=function(e){var t=Object(Y.useState)(""),n=Object(re.a)(t,2),a=n[0],i=n[1],r=Object(Y.useRef)(null);return Object(Y.useEffect)((function(){r.current.scrollTop=r.current.scrollHeight}),[e.messages.length]),Object(ue.jsxs)("div",{id:"left-panel",children:[Object(ue.jsxs)("div",{id:"online-players",children:[Object(ue.jsxs)("h3",{id:"player-count",children:["Online Players: ",e.players.length]}),e.players.map((function(e){return Object(ue.jsx)("div",{className:"player-name",style:{color:"rgb(".concat(255*e.color.r,",").concat(255*e.color.g,",").concat(255*e.color.b,")")},children:e.name},e.id)}))]}),Object(ue.jsx)("div",{className:"hr"}),Object(ue.jsxs)("div",{id:"chat",children:[Object(ue.jsxs)("div",{id:"messages",ref:r,children:[Object(ue.jsx)("h3",{children:"Chat"}),e.messages.map((function(e){return Object(ue.jsxs)("div",{className:"message",children:[Object(ue.jsx)("span",{className:"player-name",style:{color:"rgb(".concat(255*e.color.r,",").concat(255*e.color.g,",").concat(255*e.color.b,")")},children:e.name}),Object(ue.jsx)("span",{children:e.message})]})}))]}),Object(ue.jsxs)("form",{id:"chatbox",onSubmit:function(t){t.preventDefault(),a.length>0&&(e.sendMessage(a),i(""))},children:[Object(ue.jsx)("input",{autoComplete:"off",type:"text",value:a,onChange:function(e){return i(e.target.value)}}),Object(ue.jsx)("button",{children:"Send"})]})]})]})};function ze(){var e=Object(Y.useState)(!0),t=Object(re.a)(e,2),n=t[0],a=t[1];return Object(ue.jsxs)(ue.Fragment,{children:[n?Object(ue.jsxs)("div",{id:"help-box",children:[Object(ue.jsx)("h1",{children:"Welcome to Island Painter!"}),Object(ue.jsxs)("h2",{children:["Powered by ",Object(ue.jsx)("a",{href:"https://babylonjs.com/",children:"Babylon.js"})]}),Object(ue.jsx)("p",{className:"big",children:"Just click anywhere to start terraforming and building!"}),Object(ue.jsx)("p",{className:"big",children:"Share the link with a friend to build together."}),Object(ue.jsx)("p",{className:"big",children:"You can always reopen this window using the button in the bottom right \ud83d\ude09"}),Object(ue.jsxs)("p",{children:["Created by ",Object(ue.jsx)("a",{href:"https://twitter.com/DarraghBurke13",children:"Darragh Burke"})]}),Object(ue.jsxs)("p",{children:["Get the source at ",Object(ue.jsx)("a",{href:"https://github.com/darraghjburke/IslandPainter",children:"GitHub"})," "]}),Object(ue.jsxs)("p",{children:["Networking using ",Object(ue.jsx)("a",{href:"https://www.colyseus.io/",children:"Colyseus"}),". Assets by ",Object(ue.jsx)("a",{href:"https://kaylousberg.itch.io/kaykit-medieval-builder-pack",children:"Kay Lousberg"})," - check out their work!"]}),Object(ue.jsxs)("p",{children:["Hex coordinate conversions by ",Object(ue.jsx)("a",{href:"https://www.redblobgames.com/grids/hexagons",children:"RedBlobGames"}),". Hand drawn CSS from ",Object(ue.jsx)("a",{href:"https://codemyui.com/hand-drawn-border-buttons-css/",children:"CodeMyUI"}),"."]}),Object(ue.jsx)("button",{onClick:function(){return a(!1)},children:"X"})]}):Object(ue.jsx)(ue.Fragment,{}),Object(ue.jsx)("button",{onClick:function(){return a(!n)},id:"help-button",children:"?"})]})}var Be=function e(t,n,a){var i=this;Object(ce.a)(this,e),this.assetContainer=void 0,a.addContainerTask("task","","".concat("/IslandPainter","/assets/").concat(t,"/"),"".concat(n,".glb")).onSuccess=function(e){i.assetContainer=e.loadedContainer}};function Ne(e,t){var n=new se.Color3(0,0,0);e.focusing.forEach((function(t){n.r+=t.color.r/e.focusing.length,n.g+=t.color.g/e.focusing.length,n.b+=t.color.b/e.focusing.length})),t.getChildMeshes().forEach((function(t){0==e.focusing.length?t.renderOutline=!1:(t.renderOutline=!0,t.outlineColor=n,t.outlineWidth=.05)}))}var Ee=function(){var e=Object(Y.useState)(-1),t=Object(re.a)(e,2),n=t[0],a=t[1],i=Object(Y.useState)(new Te),r=Object(re.a)(i,2),c=r[0],o=r[1],s=Q.a.useState({}),l=Object(re.a)(s,2),b=(l[0],l[1]),u=Q.a.useCallback((function(){return b({})}),[]),j=Object(Y.useState)(null),d=Object(re.a)(j,2),h=d[0],p=d[1],O=[],f=[];function m(){return(m=Object(ie.a)(ne.a.mark((function e(t){var n;return ne.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new se.AssetsManager(t),Ce.forEach((function(e){O.push(new Be("tiles",e.asset,n))})),Se.forEach((function(e){f.push(new Be("buildings",e.asset,n))})),e.next=5,n.loadAsync();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t){return y.apply(void 0,Object(ae.a)(function(e,t){return[e%t,Math.floor(e/t)]}(e,t)))}function y(e,t){return[1.1*(Math.sqrt(3)*e+Math.sqrt(3)/2*t),1.1*3/2*t]}return Object(ue.jsxs)("div",{children:[Object(ue.jsx)(de,{antialias:!0,onSceneReady:function(e){(function(e){return m.apply(this,arguments)})(e).then((function(){return function(e){new oe.Client("wss://mamawn.us-west-1.colyseus.dev").joinOrCreate("my_room").then((function(t){p(t),console.log(t.sessionId,"joined",t.name),t.onStateChange((function(e){o(e),u()}));var n=t.state,i=y(12.5,12.5),r=Object(re.a)(i,2),c=r[0],s=r[1];e.cameras[0].target.set(c,2,s),e.cameras[0].radius=40,n.tiles.onAdd=function(t,a){var i=g(a,n.width),r=Object(re.a)(i,2),c=r[0],o=r[1],s=new se.TransformNode("".concat(a),e);s.position.set(c,t.height,o),s.metadata={key:a};var l=O[t.terrainType].assetContainer.instantiateModelsToScene().rootNodes[0];l.setParent(s);var b=null,u=null;t.listen("building",(function(n,a){if(a){var i=se.Animation.CreateAndStartAnimation("build",b,"position.y",60,10,1,0);i.loopAnimation=!1,i.onAnimationEndObservable.add((function(e){e.target.dispose()}))}n&&((b=new se.TransformNode("building",e)).parent=s,(u=f[n.type].assetContainer.instantiateModelsToScene().rootNodes[0]).setParent(b),u.position.set(0,0,0),se.Animation.CreateAndStartAnimation("build",b,"position.y",60,10,0,1).loopAnimation=!1,t.building.listen("rotation",(function(e,n){b.rotation.y=t.building.rotation})),Ne(t,s))})),t.listen("terrainType",(function(e,n){null!==n&&l.dispose(),null!==e&&((l=O[t.terrainType].assetContainer.instantiateModelsToScene().rootNodes[0]).setParent(s),l.position.set(0,0,0),Ne(t,s))})),t.listen("height",(function(e,n){s.position.y=t.height})),t.listen("focusing",(function(){Ne(t,s)}))},e.onPointerObservable.add((function(e){var i=-1;if(e.pickInfo&&e.pickInfo.pickedMesh){for(var r=e.pickInfo.pickedMesh;!r.metadata||!r.metadata.key;)if(!(r=r.parent))return;i=r.metadata.key}e.type===se.PointerEventTypes.POINTERDOWN&&(-1!=i&&0!=n.tiles[i].focusing.length||(a(i),t.send("focus",{key:i})))}))})).catch((function(e){alert("Couldn't connect to the server, it may be in the middle of redeployment. Please refresh the page in a few minutes."),console.log("JOIN ERROR",e)}))}(e)}));var t=new se.ArcRotateCamera("camera",0,Math.PI/3,10,new se.Vector3(0,0,0),e);t.setTarget(se.Vector3.Zero()),t.lowerRadiusLimit=4,t.upperRadiusLimit=100,t.useBouncingBehavior=!0,t.useAutoRotationBehavior=!0,t.autoRotationBehavior.idleRotationWaitTime=3e4,t._useCtrlForPanning=!1,t.panningAxis=se.Vector3.Zero();var n=e.getEngine().getRenderingCanvas();t.attachControl(n,!0),new se.HemisphericLight("light",new se.Vector3(0,1,0),e).intensity=.7},onRender:function(e){},id:"my-canvas"}),Object(ue.jsx)(Re,{tile:c.tiles[n],demolishBuilding:function(){return h.send("demolish",{key:n})},buildBuilding:function(e){return h.send("build",{key:n,type:e})},setTerrainType:function(e){return h.send("changeTerrainType",{key:n,type:e})},setHeight:function(e){return h.send("setHeight",{key:n,height:e})},setRotation:function(e){return h.send("setRotation",{key:n,rotation:e})}}),Object(ue.jsx)(Ae,{players:c.players,sendMessage:function(e){return h.send("message",{message:e})},messages:c.messages}),Object(ue.jsx)("h1",{id:"world-name",children:c.name}),Object(ue.jsx)(ze,{})]})};var Fe=function(){return Object(ue.jsx)("div",{className:"App",children:Object(ue.jsx)(Ee,{})})},Me=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,257)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,r=t.getLCP,c=t.getTTFB;n(e),a(e),i(e),r(e),c(e)}))};ee.a.render(Object(ue.jsx)(Q.a.StrictMode,{children:Object(ue.jsx)(Fe,{})}),document.getElementById("root")),Me()}},[[255,1,2]]]);
//# sourceMappingURL=main.2a842ed9.chunk.js.map